<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Travel Blog</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <button onclick="window.location.href='index.html'" class="back-btn">‚Üê Back</button>

    <h1>My Travel Blog</h1>

    <!-- Blog Form -->
    <form id="blog-form" class="styled-form">
      <input type="text" id="blog-title" placeholder="Blog Title" required />
      <textarea id="blog-content" placeholder="Write your adventure..." rows="6" required></textarea>
      <input type="file" id="blog-image" accept="image/*" />
      <select id="blog-sticker">
        <option value="">Choose a sticker</option>
        <option value="üåç">üåç</option>
        <option value="‚úàÔ∏è">‚úàÔ∏è</option>
        <option value="üó∫Ô∏è">üó∫Ô∏è</option>
        <option value="üèûÔ∏è">üèûÔ∏è</option>
        <option value="üèñÔ∏è">üèñÔ∏è</option>
      </select>
      <button type="submit">Post Blog</button>
    </form>

    <!-- Blog Posts -->
    <div id="posts"></div>
  </div>

  <script>
    const blogForm = document.getElementById('blog-form');
    const postsContainer = document.getElementById('posts');

    let blogPosts = JSON.parse(localStorage.getItem('blogPosts') || '[]');
    const username = "current_user"; // static for demo

    // Increment views when visiting
    blogPosts = blogPosts.map(post => {
      if (post.author === username) post.views += 1;
      return post;
    });
    localStorage.setItem('blogPosts', JSON.stringify(blogPosts));

    function renderPosts() {
      postsContainer.innerHTML = "";
      const userPosts = blogPosts.filter(p => p.author === username);

      userPosts.forEach((post, index) => {
        const div = document.createElement('div');
        div.className = "post";

        div.innerHTML = `
          <h3>${post.title} ${post.sticker || ""}</h3>
          <p>${post.content}</p>
          ${post.image ? `<img src="${post.image}" style="max-width:100%;border-radius:12px;margin:10px 0;" />` : ""}
          <p><strong>Views:</strong> ${post.views} | <strong>Likes:</strong> ${post.likes}</p>
          <button onclick="likePost(${index})">‚ù§Ô∏è Like</button>
          <button onclick="deletePost(${index})">üóëÔ∏è Delete</button>
        `;
        postsContainer.appendChild(div);
      });
    }
    document.querySelectorAll('.delete-post').forEach(button => {
  button.addEventListener('click', function () {
    const index = this.getAttribute('data-index');
    if (index !== null) {
      blogPosts.splice(index, 1); // Remove post
      localStorage.setItem('blogPosts', JSON.stringify(blogPosts)); // Update localStorage
      renderPosts(); // Re-render updated posts
    }
  });
});


    function likePost(index) {
      const realIndex = blogPosts.findIndex((p, i) => p.author === username && i === index);
      if (realIndex !== -1) {
        blogPosts[realIndex].likes += 1;
        localStorage.setItem('blogPosts', JSON.stringify(blogPosts));
        renderPosts();
      }
    }

    function deletePost(index) {
      const realIndex = blogPosts.findIndex((p, i) => p.author === username && i === index);
      if (realIndex !== -1) {
        if (confirm("Are you sure you want to delete this post?")) {
          blogPosts.splice(realIndex, 1);
          localStorage.setItem('blogPosts', JSON.stringify(blogPosts));
          renderPosts();
        }
      }
    }

    blogForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const title = document.getElementById('blog-title').value.trim();
      const content = document.getElementById('blog-content').value.trim();
      const sticker = document.getElementById('blog-sticker').value;
      const imageInput = document.getElementById('blog-image');
      const image = imageInput.files[0];

      if (title && content) {
        const reader = new FileReader();
        reader.onload = function () {
          const newPost = {
            title,
            content,
            image: image ? reader.result : "",
            sticker,
            views: 1,
            likes: 0,
            author: username,
            date: new Date().toLocaleString()
          };
          blogPosts.push(newPost);
          localStorage.setItem('blogPosts', JSON.stringify(blogPosts));
          blogForm.reset();
          renderPosts();
        };

        if (image) {
          reader.readAsDataURL(image);
        } else {
          reader.onload(); // call manually if no image
        }
      }
    });

    renderPosts();
  </script>
</body>
</html>
